# EC2

## EC2에 대해서
amazon elastic compute cloud는 가상 서버를 생성할 수 있는 서비스이다.
- os는 aws에서 제공하여 선택하여 사용할 수 있다.
- 온프레미스는 사용자가 하드웨어부터 os까지 다 준비해야 하지만, EC2는 가상머신을 생성할때 os를 같이 설치하므로 가상머신을 사용할 준비만 되면 바로 os를 사용가능하다.
- 자원을 편하게 선택하여 서버의 사양을 자유롭게 선택할 수 있고 생성한 후에도 자유롭게 변경 및 삭제 할 수 있다.
- 가상서버의 단위는 인스턴스로 관리한다. 인스턴스는 가상서버의 사양등을 묶어서 표현한거다.
- 요금은 인스턴스의 사양 또는 이용 기간등의 따라 부과된다.

## 가상 서버 생성
총 5가지의 설정을 해야한다.
- amazon 머신 이미지 선택을 해야한다. 이는 os와 소프트웨어가 설정된 템플릿을 aws에서 준비한 ami에서 선택하는 것이다.
- 인스턴스 사양 선택을 한다. 이는 인스턴스에 자원양을 선택하는 것이다.
- 이후 배포할 네트워크에 vpc를 선택한다.
- 스토리지 용량(EBS)을 설정한다.
- 마지막으로 접근권한 설정을 위해 보안그룹을 선택한다.
- 인스턴스 생성 후에는 리녹스는 ssh, 윈도우는 원격 데스크톱 등 관리 시스템 기능을 이용해 연결 가능한다. aws systems manager를 활용하여 인스턴스를 연결할 수 있다.

## 인스턴스 유형

m6g.medium 이라고 했을 때 앞에 m의 위치한것은 패밀리라고 한다. 메모리와 cpu 등의 자원 중 어느걸 우선시 하는지 나타낸다. 6은 세대를 의미한다. g의 위차한 문자는 추가기능이다. 마지막으로 미디엄은 크기를 의미한다.
- 추가 기능은 graviton2는 g, 네트워크 강화는 n이다. 추가 기능이 없는 유형도 있다.

### 인스턴스 패밀리
- T: 버그트 가능한 범용 유형
- M: 균형 잡힌 범용 유형
- C: 컴퓨팅 최적화
- R: 메모리 최적화
- P: 고속 컴퓨팅
- I: 스토리지 최적화

## 인스턴스 요금제 유형
이용시간과 사양등의 따라 지불하는 요금이 발생하는데 일반적으로 사용하는 요금제는 온디맨드 인스턴스이다.
- 이외에도 1년 또는 3년 등의 요금을 선불로 지불하고 이용하는 예약 인스턴스(최대 72퍼 할인)
- 예약 인스턴스와 기간 약정 조건은 비슷하지만 패밀리나 크기를 지정하지 않고 할당해 구매할 수 있는 절감형 플랜도 있다.
- 마지막으로 예약보다 저렴한 스팟요금제가 있다. 스팟요금제는 aws에서 사용하지 않는 자원을 활요해서 인스턴스를 사용하는 요금 모델이다.(최대 90퍼 할인)

### 그 밖의 EC2 관련 요금
네트워크 외부로의 데이터 통신, 데이터를 저장하는 스토리지 등에서 요금이 발생한다.
- 대체적으로 인스턴스의 비해 저렴하지만 데이터량과 외부 통신을 하는 경우 신경 써야한다.

# 가상 서버 외부 공개
EC2와 인터넷 간 통로를 설정해야 인터넷을 통해 pc나 스마트폰이 접속 가능하다.
- 퍼블릭 서브넷에 EC2 배치
- 퍼블리 IP주소를 EC2에 부여
- 보안 그룹에서 외부로부터의 접근을 허가

## 퍼블릭 서브넷
인터넷과 통신할 수 있는 서브넷, 서브넷은 EC2를 배치하는 네트워크
- 퍼블릭 IP는 인터넷과 통신할 수 있는 ip 주소, ip 주소는 EC2의 위치를 나타내는 주소
- 프라이빗 서브넷은 인터넷과 직접 통신할 수 없는 서브넷, aws내에서 통신

### 보안 그룹
보안그룹에서 접속 허가.
- 웹사이트라면 80번이나 443번 포트 허가
- ssh는 22번 포트 허가
- 보안 그룹은 EC2 이외에도 ECS, RDS 등과 같은 ip를 가지는 다른 서비스에서도 사용된다
- 용도마다 키-값에 별칭을 잘 설정하여 실수하지 않도록 해야한다.
- 필요없는 보안 그룹은 바로 삭제해야한다.

## 서버 접근 제어
접속에 대한 접근 제어는 보안 그룹을 이용한다. 보안그룹은 온프레미스의 방화벽 기능을 수행한다.
- 인바운드와 아웃바운드 규칙을 활용하여 제어한다
- 인바운드 규칙은 내 시스템으로 들어오는 데이터 및 요청을 혀용하는지의 대한 것이고
- 아웃바운드 규칙은 내 시스템에서 외부로 나가는 데이터 및 요청을 허용하는지의 대한 것이다.
- 규칙을 추가할때 내가 사용하고 있는 다른 인스턴스의 보안 그륩 id를 지정해 내부적으로 통신이 가능하다.

# 부하에 따라 서버를 자동으로 추가 및 삭제

## 서버 자동 추가 및 제거
amazon ec2 auto scaling(auto scaling)기능을 사용하여 서버 추가 및 제거를 부하 상황에 맞게 자동으로 수행시킬 수 있다.
- 서버 추가하는 것을 스케일 아웃
- 제거하는 것을 스케일 인
- 특정조건에 따라 서버를 추가하거나 제거하게 하는 것이다. 예를 들어 cpu 사용률 50퍼가 되면 1개의 인스턴스를 추가하고 25퍼 미만으로 내려가면 1개의 인스턴스를 제거하는 식의 사용률에 따른 추가 및 제거 기능이다.

## 대상 추적 조정 정책
이것은 위에 auto scaling과 다르게 목표 사용률을 지정해 지정한 값을 유지하게끔 인스턴스 수를 자동으로 조절하는 기능이다.
- cpu 사용률이 50퍼로 목표를 잡았다면 50퍼를 넘으면 서버를 추가하고 미만으로 떨어지면 제거하는 식으로 자동으로 작동한다.
- 대상 추적 조정 정책은 무료 기능이며, 사용자는 늘어난 인스턴스의 비용만 지불하면 된다.

## 스케줄 스케일
자원의 부하가 아닌 사용자 접속 수와 같은 기준을 이용하여 자동 추가 및 삭제 하는 설정이 가능하고 일정을 세워 인스턴스 수를 조절하는 기능이다.
- 이 기능은 주말 같은 특정날에 동접자가 몰리는 상황을 예측하여 대비할 수 있도록 만들어진 서비스이다.

### auto scaling
그래서 이 기능은 장애 대비용으로도 사용되며 지정된 인스턴스를 유지하는 기능이 있어 예기치 못한 장애로 인스턴스가 멈추는 상황을 방지한다.
- 서버의 수요를 예측하는 예측 스케일링 기능이나 인스턴스를 시작할 때 템플릿이 부팅 설정 버전 관리 등 많은 기능이 있다.

# 서버리스 컴퓨팅 서비스

## Lambda
lambda는 서버리스 커뮤팅 서비스다. os와 같은 인프라를 관리할 필요가 없으므로 사용자는 프로그램 코드를 준비하고 lambda에 업로드만 하면 된다.
- 서버리스란 가동되는 서버가 없다가 아닌 관리할 필요가 없는 서버라는 뜻이다. 인프라 관리는 aws에게 맡기고 코드 개발에만 집중 가능하다.
- node.js, java, python, powershll, ruby, c#, go 를 지원한다.
- 현재는 컨테이너 이미지 지원도 시작했다. 람다에 배포 가능하다
- 장점으로 보안, 비용, 가용성, 확장성이 좋다는 장점이 있다.
- 람다에서는 함수라고 하는 단위로 프로그램 코드를 관리하고 처리한다.
- 함수는 aws 관리 콘솔 및 여러 도구로 생성할 수 있다.(함수를 화면상에서 생성해 프로그램 코드를 쓰는 것만으로 실행 가능하다.)
- 컴파일이 불필요한 일부의 언어만 가능하다 위에 내용은

## lambda와 ec2의 차이점
ec2를 lambda아 비교했을 때 장점
- 온프레미스의 응용 프로그램을 aws로 이전하는 경우 os 설정 등을 그대로 사용할 수 있다.
- 인스턴스 유형, os, 네트워크 등을 자유롭게 설정할 수 있는 유연성이 있다.
- 대량의 트래픽이나 접속을 상시 처리하는 경우 ec2쪽이 저렴해질 수 있다.
- 서버에 프로그램을 배포한다는 기존 방식으로 개발을 진행할 수 있다. 람다는 aws의 독자적인 설정방법과 개발 방법이 있으므로 초보자에게는 어려울 수 있다.
- 실행 중인 응용 프로그램의 상황, 개발하는 조직의 기술 등 상황에 따라 적절한 서비스를 선택해야한다.

### json
이는 데이터 표현 방식의 기본적인 표현 방법이다.
- 키와 값을 콜론으로 구분해 작성한다 배열안에 여러개의 키와 값의 쌍을 정의 할 수 있다.


